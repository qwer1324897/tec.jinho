<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
    .container {
        width: 1100px;
        height: 500px;
        margin: auto;
    }
    .aside {
        width: 100px;
        height: 100%;
        float: left;
        background-color: aliceblue;
        align-items: center;
    }
    .content {
        width: 1000px;
        height: 100%;
        float: right;
        background-color: azure;
    }
</style>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    let map;  // 모든 함수에서 접근하게 될 구글맵 객체

    // 아래쪽 구글맵 스크립트에 의해 구글맵이 로드가 되면, 이 함수를 호출하게 됨.
    function init() {
        let mapProp= {
        center:new google.maps.LatLng(35.621111,129.003056),
        zoom:12,
        };

        map = new google.maps.Map(document.querySelector(".content"),mapProp);
    }
    
    // 서버로부터 받아온 데이터를 파싱한 객체를 이용하여 화면에 표현.
    function render(obj) {
    	console.log("렌더링 전 넘겨받은 객체는", obj);
    	
    	// 구글맵에 마커 표시하기	 (각 제작사에서 제공하는 API 를 이용. google, naver, kakao .. 등)
    	let lati = obj.response.body.items.item[0].lat;	// 위도
    	let lng = obj.response.body.items.item[0].lot;	// 경도
    	
    	// 처음 뜨는 화면의 카메라의 위치부터 수정
    	let pos = new google.maps.LatLng(lati,lng);
    	map.setCenter(pos);
    	
    	let marker = new google.maps.Marker({
    		position: pos,
    		animation:google.maps.Animation.BOUNCE
    	});
    	
    	// 생성된 마커를 원하는 map 객체에 적용하기
    	marker.setMap(map);
    	
    	
    	
    	//팝업 윈도우 띄우기
    	let info = obj.response.body.items.item[0].frtrlNm;	// 산의 이름
    	
    	let infowindow = new google.maps.InfoWindow({
    		content: info
    	});
    	infowindow.open(map,marker);		// 어떤 맵 객체에 어떤 마커위로 띄울지 결정
    	
    };

    // map 같은 앱은 새로고침이 발생하면 이용할 때 굉장히 불편하기 때문에, 서버로부터 데이터를 비동기(백그라운드)로 가져와야한다.
    function getList() {
        let xhttp = new XMLHttpRequest();

        // 요청에 대한 서버측의 응답이 들어오면, 브라우저가 자바스크립트에게 도착했음을 알린다. 이 때, 자바스크립트는 아래의 익명함수(기능으론 콜백함수)를 호출.
        xhttp.onload = function() {
			// 서버에서 전송한 문자열 받기
			console.log("서버로부터 받은 문자열은", this.responseText);
			let object = JSON.parse(this.responseText);	// 서버에서 가져온 데이터는 문자열이므로, 사용하기 편리한 객체로 전환.
			console.log("문자열 파싱 결과는" ,object);
			
			render(object);
			
        };
        xhttp.open("GET", "/map/list.jsp");  // Servlet, jsp 둘 다 가능하지만 디자인이 포함되지 않으므로 원칙상 Servlet이 맞지만 바빠서 그냥 jsp로 
        xhttp.send();   // 비동기 요청 발생
    }

    $(()=>{
        $("button").click(()=>{
            getList();
        })
    });
</script>
</head>
<body>
    <div class="container">
        <div class="aside">
            <button type="button">Load</button>
        </div>
        <div class="content">

        </div>
    </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA05drqI-Jt-qCproTtbEEe0Hut5XRe4TY&callback=init"></script>   <!-- 여기에서 init 정의 -->
</body>
</html>