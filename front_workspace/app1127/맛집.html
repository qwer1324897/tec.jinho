<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    .container {
        width: 1500px;
        height: 700px;
        margin: auto;
    }
    .aside {
        width: 200px;
        height: 100%;
        float: left;
        background-color: aliceblue;
        display: flex;
        flex-direction: column; 
        align-items: center; 
        padding: 5px; 
        box-sizing: border-box; 
    }
    .aside * {
        width: 90%;
        margin-bottom: 3px;
    }
    .aside img {
        width: 90%;
        height: 150px;
    }
    textarea {
        height: 180px;
    }
    .content {
        width: 1300px;
        height: 100%;
        float: right;
        background-color: azure;
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    // 마커 이미지 배열
    let foodName=["한식","중식","일식","양식"]  // <option>한식</option>
    let iconArray=["koreanfood.png","chinesefood.png","susi.png","pizza.png"]; // <option value="susi">일식</option>

    let mapProp;    // 다른 함수에서도 쓰게 변수 빼놓기
    let map;    // 다른 함수에서도 쓰게 변수 빼놓기

    let storeList = new Array();    // 브라우저 닫기 전까지 상점들 모아놓을 용


    function init() {
        // 마커를 동적으로 채운다.
        // icon 이라는 class로 메모리에 올라온 select DOM의 자식 요소인 option DOM을 동적으로 생성하여
        // select DOM에 부착한다.

        let icon = document.querySelector(".icon");
        
        for(let i=0; i<foodName.length; i++) {
            // select DOM에 부착
            let option = document.createElement("option");   // <option></option> 과 같다.
            option.text=foodName[i];
            option.value=iconArray[i];
            document.querySelector(".icon").add(option);
        }

        // 완성된 select 박스에 change 이벤트 적용하자
        // 이미지를 다른 것으로 선택할 때마다 이미지를 변경해야 하므로
        icon.addEventListener("change", function(){
            // alert("선택하신 이미지는 " + this.value);  this: 현재 이벤트를 일으킨 주체의 DOM. icon.value로 써도 무방.

            // 문서내 pic(img DOM의 src 속성값)을 this.value로 교체
            document.querySelector(".pic").src="../images/mapicon/"+this.value;
        });

        mapProp= {
            center:new google.maps.LatLng(37.49959, 127.03046),
            zoom:17,
            gestureHandling: 'greedy'
        };
        map = new google.maps.Map(document.getElementById("content"),mapProp);

        // addMarker(map, mapProp.center, document.querySelector(".pic").src); // 잘 나오는지 테스트
    }
    // 구글맵에 마커 추가
    // 매개변수 map : 기존에 떠 있는 구글맵 객체
    // 매개변수 pos : 위도, 경도 정보를 가진 객체
    function addMarker(map, pos, path, message) {
        let marker = new google.maps.Marker({
            position: pos,
            animation:google.maps.Animation.BOUNCE,
            icon:{  // icon에 비단 경로뿐만 아니라 더 많은 속성을 설정하기 위해 객체로 표현
                url: path,
                scaledSize: new google.maps.Size(28,28)
            }
        });
        marker.setMap(map);

        var infowindow = new google.maps.InfoWindow({
            content:message
        });
        infowindow.open(map, marker);
    }

    // 맛집 등록(정보 저장, 화면에 유저가 선택한 이미를 마커로 로드)
    function regist() {
        // 현실의 한 상점을 표현하기 위해 OOP 에서 객체를 활용한다.
        // 클래스로 정의해도 되지만, 단순 데이터 저장용으로는 굳이 로직을 작성하는 메서드가 필요한 게 아니기 때문에
        // 클래스까지 정의할 필요는 없고, 인스턴스를 바로 사용할 수 있는 js 고전식 객체를 활용한다.

        // JQuery 문법 구조는 $(제어할 누구-css 선택자 그대로 이용).어떻게(메서드)
        let store = {
            storeName : $("#store_id").val(),   // 이걸 바닐라스크립트로 표현하면, document.querySelector("storeName").value 와 같다.
            latLng : $("#latLng").val(),
            url : $("#url").val(),
            icon : $("#icon").val(),
            info : $("#info").val()
        };  // 이 객체는 그 자체가 인스턴스이다.
        console.log("방금 등록한 상점은 ", store);

        // 위에서 전역 변수로 선언한 storeList[] 에다가 상점 추가하기
        storeList.push(store);   // js에서의 배열은 java 언어에서 java.util.List 와 매우 흡사하다.

        // 유저가 입력한 위도, 경도 문자열을 쉼표(,) 기준으로 나누고 공백을 제거한다.
        let arr = store.latLng.split(",");

        // 기존의 고정된 역삼동 학원 위도,경도를 쓰지 말고, 위도, 경도를 처리하는 객체를 새롭게 생성한다.
        let position = new google.maps.LatLng(parseFloat(arr[0].trim()), parseFloat(arr[1].trim()));

        addMarker(map, position, document.querySelector(".pic").src, store.storeName+"<br>"+store.info); // 잘 나오는지 테스트
    }
</script>
<script>
    // function init() {
    //     var mapProp= {
    //     center:new google.maps.LatLng(37.49959, 127.03046),
    //     zoom:18,
    //     };
    //     let map = new google.maps.Map(document.getElementById("content"),mapProp);

    //     // 맵에 마커 띄우기
    //     let marker = new google.maps.Marker({position: mapProp.center});

    //     marker.setMap(map);
    // }
</script>
<body>
    <div class="container">
        <div class="aside">
            <input type="text" placeholder="상호명" id="store_id">
            <input type="text" placeholder="위도, 경도" id="latLng">
            <input type="text" placeholder="URL" id="url">
            <select class="icon">
                <option>마커 선택</option>
            </select>
            <img class="pic">
            <textarea id="info"></textarea>
            <button onclick="regist()">등록</button>
        </div>
        <div class="content" id="content">
        </div>
    </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDYZnPpGlwgUBn1etA50w6Uzecg9aWmkxA&callback=init"></script>  
</body>
</html>